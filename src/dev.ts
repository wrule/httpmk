import Koa from 'koa';
import Router from 'koa-router';
import timers from 'timers/promises';
import send from 'koa-send';
import axios from 'axios';
import fs from 'fs';
import dayjs from 'dayjs';

const ppt = [{"children":[{"children":[],"id":"2","barWidth":"","executionMilliseconds":"","agent":null,"hasException":false,"simpleClassName":"","title":"http.status.code","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":1,"hasChild":false,"gap":"","isMethod":false,"end":0,"arguments":"200","begin":"","applicationName":null,"apiType":"","executeTime":"","elapsedTime":"","rootElapsedTime":"474"},{"children":[],"id":"3","barWidth":"","executionMilliseconds":"","agent":null,"hasException":false,"simpleClassName":"","title":"REMOTE_ADDRESS","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":1,"hasChild":false,"gap":"","isMethod":false,"end":0,"arguments":"192.168.0.37","begin":"","applicationName":null,"apiType":"","executeTime":"","elapsedTime":"","rootElapsedTime":"474"},{"children":[{"children":[{"children":[{"children":[{"children":[{"children":[],"id":"9","barWidth":"","executionMilliseconds":"","agent":null,"hasException":false,"simpleClassName":"","title":"http.status.code","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":6,"hasChild":false,"gap":"","isMethod":false,"end":0,"arguments":"200","begin":"","applicationName":null,"apiType":"","executeTime":"","elapsedTime":"","rootElapsedTime":"474"},{"children":[{"children":[],"id":"11","barWidth":"","executionMilliseconds":"","agent":null,"hasException":false,"simpleClassName":"","title":"http.status.code","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":7,"hasChild":false,"gap":"","isMethod":false,"end":0,"arguments":"200","begin":"","applicationName":null,"apiType":"","executeTime":"","elapsedTime":"","rootElapsedTime":"474"},{"children":[],"id":"12","barWidth":"","executionMilliseconds":"","agent":null,"hasException":false,"simpleClassName":"","title":"REMOTE_ADDRESS","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":7,"hasChild":false,"gap":"","isMethod":false,"end":0,"arguments":"172.18.0.4","begin":"","applicationName":null,"apiType":"","executeTime":"","elapsedTime":"","rootElapsedTime":"474"},{"children":[{"children":[{"children":[{"children":[],"id":"16","barWidth":"0","executionMilliseconds":"0","agent":"3fdfdff0000000_7","hasException":false,"simpleClassName":"HikariDataSource","title":"getConnection()","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":10,"hasChild":false,"gap":"0","isMethod":true,"end":1553567004858,"arguments":"","begin":1553567004858,"applicationName":"store","apiType":"HIKARICP","executeTime":"02:23:24 858","elapsedTime":"0","rootElapsedTime":"474"},{"children":[],"id":"17","barWidth":"0","executionMilliseconds":"1","agent":"3fdfdff0000000_7","hasException":false,"simpleClassName":"ConnectionImpl","title":"setAutoCommit(boolean autoCommitFlag)","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":10,"hasChild":false,"gap":"1","isMethod":true,"end":1553567004860,"arguments":"false","begin":1553567004859,"applicationName":"store","apiType":"MYSQL(trace_mock)","executeTime":"02:23:24 859","elapsedTime":"1","rootElapsedTime":"474"},{"children":[{"children":[],"id":"19","barWidth":"","executionMilliseconds":"","agent":null,"hasException":false,"simpleClassName":"","title":"SQL","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":11,"hasChild":false,"gap":"","isMethod":false,"end":0,"arguments":"select goods0_.id as id1_0_0_, goods0_.name as name2_0_0_, goods0_.stock as stock3_0_0_ from goods goods0_ where goods0_.id=?","begin":"","applicationName":null,"apiType":"","executeTime":"","elapsedTime":"","rootElapsedTime":"474"}],"id":"18","barWidth":"0","executionMilliseconds":"0","agent":"3fdfdff0000000_7","hasException":false,"simpleClassName":"ConnectionImpl","title":"prepareStatement(String sql)","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":10,"hasChild":false,"gap":"0","isMethod":true,"end":1553567004860,"arguments":"","begin":1553567004860,"applicationName":"store","apiType":"MYSQL(trace_mock)","executeTime":"02:23:24 860","elapsedTime":"0","rootElapsedTime":"474"},{"children":[{"children":[],"id":"21","barWidth":"","executionMilliseconds":"","agent":null,"hasException":false,"simpleClassName":"","title":"SQL","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":11,"hasChild":false,"gap":"","isMethod":false,"end":0,"arguments":"select goods0_.id as id1_0_0_, goods0_.name as name2_0_0_, goods0_.stock as stock3_0_0_ from goods goods0_ where goods0_.id=?","begin":"","applicationName":null,"apiType":"","executeTime":"","elapsedTime":"","rootElapsedTime":"474"},{"children":[],"id":"22","barWidth":"","executionMilliseconds":"","agent":null,"hasException":false,"simpleClassName":"","title":"SQL-BindValue","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":11,"hasChild":false,"gap":"","isMethod":false,"end":0,"arguments":"1","begin":"","applicationName":null,"apiType":"","executeTime":"","elapsedTime":"","rootElapsedTime":"474"}],"id":"20","barWidth":"0","executionMilliseconds":"0","agent":"3fdfdff0000000_7","hasException":false,"simpleClassName":"PreparedStatement","title":"executeQuery()","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":10,"hasChild":false,"gap":"0","isMethod":true,"end":1553567004860,"arguments":"","begin":1553567004860,"applicationName":"store","apiType":"MYSQL(trace_mock)","executeTime":"02:23:24 860","elapsedTime":"0","rootElapsedTime":"474"},{"children":[],"id":"23","barWidth":"0","executionMilliseconds":"1","agent":"3fdfdff0000000_7","hasException":false,"simpleClassName":"ConnectionImpl","title":"commit()","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":10,"hasChild":false,"gap":"0","isMethod":true,"end":1553567004861,"arguments":"","begin":1553567004860,"applicationName":"store","apiType":"MYSQL(trace_mock)","executeTime":"02:23:24 860","elapsedTime":"1","rootElapsedTime":"474"},{"children":[],"id":"24","barWidth":"0","executionMilliseconds":"0","agent":"3fdfdff0000000_7","hasException":false,"simpleClassName":"ConnectionImpl","title":"setAutoCommit(boolean autoCommitFlag)","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":10,"hasChild":false,"gap":"0","isMethod":true,"end":1553567004861,"arguments":"true","begin":1553567004861,"applicationName":"store","apiType":"MYSQL(trace_mock)","executeTime":"02:23:24 861","elapsedTime":"0","rootElapsedTime":"474"},{"children":[{"children":[],"id":"26","barWidth":"","executionMilliseconds":"","agent":null,"hasException":false,"simpleClassName":"","title":"SQL","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":11,"hasChild":false,"gap":"","isMethod":false,"end":0,"arguments":"select @@session.transaction_read_only","begin":"","applicationName":null,"apiType":"","executeTime":"","elapsedTime":"","rootElapsedTime":"474"}],"id":"25","barWidth":"0","executionMilliseconds":"1","agent":"3fdfdff0000000_7","hasException":false,"simpleClassName":"StatementImpl","title":"executeQuery(String sql)","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":10,"hasChild":false,"gap":"0","isMethod":true,"end":1553567004862,"arguments":"","begin":1553567004861,"applicationName":"store","apiType":"MYSQL(trace_mock)","executeTime":"02:23:24 861","elapsedTime":"1","rootElapsedTime":"474"}],"id":"15","barWidth":"0","executionMilliseconds":"1","agent":"3fdfdff0000000_7","hasException":false,"simpleClassName":"StoreController","title":"getStock(Long goodsId)","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":9,"hasChild":false,"gap":"0","isMethod":true,"end":1553567004862,"arguments":"","begin":1553567004858,"applicationName":"store","apiType":"SPRING_BEAN","executeTime":"02:23:24 858","elapsedTime":"4","rootElapsedTime":"474"},{"children":[],"id":"27","barWidth":"0","executionMilliseconds":"0","agent":"3fdfdff0000000_7","hasException":false,"simpleClassName":"ProxyConnection","title":"close()","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":9,"hasChild":false,"gap":"0","isMethod":true,"end":1553567004862,"arguments":"","begin":1553567004862,"applicationName":"store","apiType":"HIKARICP","executeTime":"02:23:24 862","elapsedTime":"0","rootElapsedTime":"474"}],"id":"14","barWidth":"0","executionMilliseconds":"1","agent":"3fdfdff0000000_7","hasException":false,"simpleClassName":"FrameworkServlet","title":"doGet(HttpServletRequest request, HttpServletResponse response)","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":8,"hasChild":false,"gap":"0","isMethod":true,"end":1553567004863,"arguments":"","begin":1553567004858,"applicationName":"store","apiType":"SPRING","executeTime":"02:23:24 858","elapsedTime":"5","rootElapsedTime":"474"}],"id":"13","barWidth":"0","executionMilliseconds":"0","agent":"3fdfdff0000000_7","hasException":false,"simpleClassName":"StandardHostValve","title":"invoke(Request request, Response response)","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":7,"hasChild":false,"gap":"0","isMethod":true,"end":1553567004863,"arguments":"","begin":1553567004858,"applicationName":"store","apiType":"TOMCAT_METHOD","executeTime":"02:23:24 858","elapsedTime":"5","rootElapsedTime":"474"}],"id":"10","barWidth":"0","executionMilliseconds":"0","agent":"3fdfdff0000000_7","hasException":false,"simpleClassName":"","title":"Servlet Process","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"100","tab":6,"hasChild":true,"gap":"0","isMethod":true,"end":1553567004863,"arguments":"/getStock","begin":1553567004858,"applicationName":"store","apiType":"TOMCAT","executeTime":"02:23:24 858","elapsedTime":"5","rootElapsedTime":"474"}],"id":"8","barWidth":"0","executionMilliseconds":"5","agent":"3fdfe05ff00000_6","hasException":false,"simpleClassName":"BridgeInterceptor","title":"intercept(Interceptor$Chain chain)","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":5,"hasChild":false,"gap":"0","isMethod":true,"end":1553567004863,"arguments":"http://store:8080/getStock?goodsId=1","begin":1553567004858,"applicationName":"gateway","apiType":"OK_HTTP_CLIENT","executeTime":"02:23:24 858","elapsedTime":"5","rootElapsedTime":"474"}],"id":"7","barWidth":"0","executionMilliseconds":"0","agent":"3fdfe05ff00000_6","hasException":false,"simpleClassName":"RealCall","title":"execute()","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":4,"hasChild":false,"gap":"0","isMethod":true,"end":1553567004863,"arguments":"","begin":1553567004858,"applicationName":"gateway","apiType":"OK_HTTP_CLIENT","executeTime":"02:23:24 858","elapsedTime":"5","rootElapsedTime":"474"},{"children":[{"children":[{"children":[],"id":"30","barWidth":"","executionMilliseconds":"","agent":null,"hasException":false,"simpleClassName":"","title":"http.status.code","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":6,"hasChild":false,"gap":"","isMethod":false,"end":0,"arguments":"200","begin":"","applicationName":null,"apiType":"","executeTime":"","elapsedTime":"","rootElapsedTime":"474"},{"children":[{"children":[],"id":"32","barWidth":"","executionMilliseconds":"","agent":null,"hasException":false,"simpleClassName":"","title":"http.status.code","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":7,"hasChild":false,"gap":"","isMethod":false,"end":0,"arguments":"200","begin":"","applicationName":null,"apiType":"","executeTime":"","elapsedTime":"","rootElapsedTime":"474"},{"children":[],"id":"33","barWidth":"","executionMilliseconds":"","agent":null,"hasException":false,"simpleClassName":"","title":"REMOTE_ADDRESS","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":7,"hasChild":false,"gap":"","isMethod":false,"end":0,"arguments":"172.18.0.4","begin":"","applicationName":null,"apiType":"","executeTime":"","elapsedTime":"","rootElapsedTime":"474"},{"children":[{"children":[{"children":[{"children":[{"children":[{"children":[],"id":"39","barWidth":"","executionMilliseconds":"","agent":null,"hasException":false,"simpleClassName":"","title":"REMOTE_ADDRESS","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":12,"hasChild":false,"gap":"","isMethod":false,"end":0,"arguments":"172.18.0.5:48566","begin":"","applicationName":null,"apiType":"","executeTime":"","elapsedTime":"","rootElapsedTime":"474"},{"children":[{"children":[],"id":"41","barWidth":"","executionMilliseconds":"","agent":null,"hasException":false,"simpleClassName":"","title":"dubbo.rpc","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":13,"hasChild":false,"gap":"","isMethod":false,"end":0,"arguments":"OrderService:placeOrder","begin":"","applicationName":null,"apiType":"","executeTime":"","elapsedTime":"","rootElapsedTime":"474"},{"children":[],"id":"42","barWidth":"0","executionMilliseconds":"0","agent":"3fdfdfe2700000_7","hasException":false,"simpleClassName":"HikariDataSource","title":"getConnection()","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":13,"hasChild":false,"gap":"0","isMethod":true,"end":1553567004864,"arguments":"","begin":1553567004864,"applicationName":"service","apiType":"HIKARICP","executeTime":"02:23:24 864","elapsedTime":"0","rootElapsedTime":"474"},{"children":[],"id":"43","barWidth":"0","executionMilliseconds":"0","agent":"3fdfdfe2700000_7","hasException":false,"simpleClassName":"ConnectionImpl","title":"setAutoCommit(boolean autoCommitFlag)","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":13,"hasChild":false,"gap":"0","isMethod":true,"end":1553567004864,"arguments":"false","begin":1553567004864,"applicationName":"service","apiType":"MYSQL(trace_mock)","executeTime":"02:23:24 864","elapsedTime":"0","rootElapsedTime":"474"},{"children":[{"children":[{"children":[],"id":"46","barWidth":"","executionMilliseconds":"","agent":null,"hasException":false,"simpleClassName":"","title":"SQL","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":15,"hasChild":false,"gap":"","isMethod":false,"end":0,"arguments":"insert into trace_order (gid, gmt_create, quantity, uid) values (?, ?, ?, ?)","begin":"","applicationName":null,"apiType":"","executeTime":"","elapsedTime":"","rootElapsedTime":"474"}],"id":"45","barWidth":"0","executionMilliseconds":"0","agent":"3fdfdfe2700000_7","hasException":false,"simpleClassName":"ConnectionImpl","title":"prepareStatement(String sql, int autoGenKeyIndex)","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":14,"hasChild":false,"gap":"0","isMethod":true,"end":1553567004864,"arguments":"","begin":1553567004864,"applicationName":"service","apiType":"MYSQL(trace_mock)","executeTime":"02:23:24 864","elapsedTime":"0","rootElapsedTime":"474"},{"children":[{"children":[],"id":"48","barWidth":"","executionMilliseconds":"","agent":null,"hasException":false,"simpleClassName":"","title":"SQL","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":15,"hasChild":false,"gap":"","isMethod":false,"end":0,"arguments":"insert into trace_order (gid, gmt_create, quantity, uid) values (?, ?, ?, ?)","begin":"","applicationName":null,"apiType":"","executeTime":"","elapsedTime":"","rootElapsedTime":"474"},{"children":[],"id":"49","barWidth":"","executionMilliseconds":"","agent":null,"hasException":false,"simpleClassName":"","title":"SQL-BindValue","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":15,"hasChild":false,"gap":"","isMethod":false,"end":0,"arguments":"1, 2019-03-26 10:23:24.864, 1, 1","begin":"","applicationName":null,"apiType":"","executeTime":"","elapsedTime":"","rootElapsedTime":"474"}],"id":"47","barWidth":"0","executionMilliseconds":"0","agent":"3fdfdfe2700000_7","hasException":false,"simpleClassName":"PreparedStatement","title":"executeUpdate()","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":14,"hasChild":false,"gap":"1","isMethod":true,"end":1553567004865,"arguments":"","begin":1553567004865,"applicationName":"service","apiType":"MYSQL(trace_mock)","executeTime":"02:23:24 865","elapsedTime":"0","rootElapsedTime":"474"},{"children":[],"id":"50","barWidth":"0","executionMilliseconds":"1","agent":"3fdfdfe2700000_7","hasException":false,"simpleClassName":"Jedis","title":"hset(String key, String field, String value)","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":14,"hasChild":false,"gap":"0","isMethod":true,"end":1553567004866,"arguments":"write: 0ms, read: 0ms","begin":1553567004865,"applicationName":"service","apiType":"REDIS","executeTime":"02:23:24 865","elapsedTime":"1","rootElapsedTime":"474"}],"id":"44","barWidth":"0","executionMilliseconds":"1","agent":"3fdfdfe2700000_7","hasException":false,"simpleClassName":"OrderServiceImpl","title":"placeOrder(OrderForm orderForm)","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":13,"hasChild":false,"gap":"0","isMethod":true,"end":1553567004866,"arguments":"","begin":1553567004864,"applicationName":"service","apiType":"SPRING_BEAN","executeTime":"02:23:24 864","elapsedTime":"2","rootElapsedTime":"474"},{"children":[],"id":"51","barWidth":"0","executionMilliseconds":"464","agent":"3fdfdfe2700000_7","hasException":false,"simpleClassName":"ConnectionImpl","title":"commit()","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":13,"hasChild":false,"gap":"0","isMethod":true,"end":1553567005330,"arguments":"","begin":1553567004866,"applicationName":"service","apiType":"MYSQL(trace_mock)","executeTime":"02:23:24 866","elapsedTime":"464","rootElapsedTime":"474"},{"children":[],"id":"52","barWidth":"0","executionMilliseconds":"0","agent":"3fdfdfe2700000_7","hasException":false,"simpleClassName":"ConnectionImpl","title":"setAutoCommit(boolean autoCommitFlag)","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":13,"hasChild":false,"gap":"0","isMethod":true,"end":1553567005330,"arguments":"true","begin":1553567005330,"applicationName":"service","apiType":"MYSQL(trace_mock)","executeTime":"02:23:25 330","elapsedTime":"0","rootElapsedTime":"474"},{"children":[],"id":"53","barWidth":"0","executionMilliseconds":"1","agent":"3fdfdfe2700000_7","hasException":false,"simpleClassName":"ProxyConnection","title":"close()","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":13,"hasChild":false,"gap":"0","isMethod":true,"end":1553567005331,"arguments":"","begin":1553567005330,"applicationName":"service","apiType":"HIKARICP","executeTime":"02:23:25 330","elapsedTime":"1","rootElapsedTime":"474"}],"id":"40","barWidth":"0","executionMilliseconds":"0","agent":"3fdfdfe2700000_7","hasException":false,"simpleClassName":"AbstractProxyInvoker","title":"invoke(Invocation invocation)","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":12,"hasChild":false,"gap":"0","isMethod":true,"end":1553567005331,"arguments":"","begin":1553567004864,"applicationName":"service","apiType":"DUBBO","executeTime":"02:23:24 864","elapsedTime":"467","rootElapsedTime":"474"}],"id":"38","barWidth":"0","executionMilliseconds":"0","agent":"3fdfdfe2700000_7","hasException":false,"simpleClassName":"","title":"Dubbo Provider Process","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"100","tab":11,"hasChild":true,"gap":"1","isMethod":true,"end":1553567005331,"arguments":"OrderService:placeOrder","begin":1553567004864,"applicationName":"service","apiType":"DUBBO_PROVIDER","executeTime":"02:23:24 864","elapsedTime":"467","rootElapsedTime":"474"}],"id":"37","barWidth":"0","executionMilliseconds":"468","agent":"3fdfdfe3800000_6","hasException":false,"simpleClassName":"AbstractInvoker","title":"invoke(Invocation inv)","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":10,"hasChild":false,"gap":"0","isMethod":true,"end":1553567005331,"arguments":"","begin":1553567004863,"applicationName":"order","apiType":"DUBBO_CONSUMER","executeTime":"02:23:24 863","elapsedTime":"468","rootElapsedTime":"474"}],"id":"36","barWidth":"0","executionMilliseconds":"0","agent":"3fdfdfe3800000_6","hasException":false,"simpleClassName":"OrderController","title":"placeOrder(Long uid, Long gid)","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":9,"hasChild":false,"gap":"0","isMethod":true,"end":1553567005331,"arguments":"","begin":1553567004863,"applicationName":"order","apiType":"SPRING_BEAN","executeTime":"02:23:24 863","elapsedTime":"468","rootElapsedTime":"474"}],"id":"35","barWidth":"0","executionMilliseconds":"0","agent":"3fdfdfe3800000_6","hasException":false,"simpleClassName":"FrameworkServlet","title":"doGet(HttpServletRequest request, HttpServletResponse response)","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":8,"hasChild":false,"gap":"0","isMethod":true,"end":1553567005331,"arguments":"","begin":1553567004863,"applicationName":"order","apiType":"SPRING","executeTime":"02:23:24 863","elapsedTime":"468","rootElapsedTime":"474"}],"id":"34","barWidth":"0","executionMilliseconds":"0","agent":"3fdfdfe3800000_6","hasException":false,"simpleClassName":"StandardHostValve","title":"invoke(Request request, Response response)","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":7,"hasChild":false,"gap":"0","isMethod":true,"end":1553567005331,"arguments":"","begin":1553567004863,"applicationName":"order","apiType":"TOMCAT_METHOD","executeTime":"02:23:24 863","elapsedTime":"468","rootElapsedTime":"474"}],"id":"31","barWidth":"0","executionMilliseconds":"0","agent":"3fdfdfe3800000_6","hasException":false,"simpleClassName":"","title":"Servlet Process","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"100","tab":6,"hasChild":true,"gap":"0","isMethod":true,"end":1553567005331,"arguments":"/placeOrder","begin":1553567004863,"applicationName":"order","apiType":"TOMCAT","executeTime":"02:23:24 863","elapsedTime":"468","rootElapsedTime":"474"}],"id":"29","barWidth":"0","executionMilliseconds":"469","agent":"3fdfe05ff00000_6","hasException":false,"simpleClassName":"BridgeInterceptor","title":"intercept(Interceptor$Chain chain)","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":5,"hasChild":false,"gap":"0","isMethod":true,"end":1553567005332,"arguments":"http://order:8080/placeOrder?uid=1&gid=1","begin":1553567004863,"applicationName":"gateway","apiType":"OK_HTTP_CLIENT","executeTime":"02:23:24 863","elapsedTime":"469","rootElapsedTime":"474"}],"id":"28","barWidth":"0","executionMilliseconds":"0","agent":"3fdfe05ff00000_6","hasException":false,"simpleClassName":"RealCall","title":"execute()","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":4,"hasChild":false,"gap":"0","isMethod":true,"end":1553567005332,"arguments":"","begin":1553567004863,"applicationName":"gateway","apiType":"OK_HTTP_CLIENT","executeTime":"02:23:24 863","elapsedTime":"469","rootElapsedTime":"474"}],"id":"6","barWidth":"0","executionMilliseconds":"0","agent":"3fdfe05ff00000_6","hasException":false,"simpleClassName":"HelloController","title":"hello()","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":3,"hasChild":false,"gap":"0","isMethod":true,"end":1553567005332,"arguments":"","begin":1553567004858,"applicationName":"gateway","apiType":"SPRING_BEAN","executeTime":"02:23:24 858","elapsedTime":"474","rootElapsedTime":"474"}],"id":"5","barWidth":"0","executionMilliseconds":"0","agent":"3fdfe05ff00000_6","hasException":false,"simpleClassName":"FrameworkServlet","title":"doGet(HttpServletRequest request, HttpServletResponse response)","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":2,"hasChild":false,"gap":"0","isMethod":true,"end":1553567005332,"arguments":"","begin":1553567004858,"applicationName":"gateway","apiType":"SPRING","executeTime":"02:23:24 858","elapsedTime":"474","rootElapsedTime":"474"}],"id":"4","barWidth":"0","executionMilliseconds":"0","agent":"3fdfe05ff00000_6","hasException":false,"simpleClassName":"StandardHostValve","title":"invoke(Request request, Response response)","isFocused":false,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"0","tab":1,"hasChild":false,"gap":"0","isMethod":true,"end":1553567005332,"arguments":"","begin":1553567004858,"applicationName":"gateway","apiType":"TOMCAT_METHOD","executeTime":"02:23:24 858","elapsedTime":"474","rootElapsedTime":"474"}],"id":"1","barWidth":"0","executionMilliseconds":"0","agent":"3fdfe05ff00000_6","hasException":false,"simpleClassName":"","title":"Servlet Process","isFocused":true,"excludeFromTimeline":false,"isAuthorized":true,"depth":"","methodType":"100","tab":0,"hasChild":true,"gap":"0","isMethod":true,"end":1553567005332,"arguments":"/order","begin":1553567004858,"applicationName":"gateway","apiType":"TOMCAT","executeTime":"02:23:24 858","elapsedTime":"474","rootElapsedTime":"474"}]

function dev() {
  const app = new Koa();
  const router = new Router();
  router.get('/1', (ctx, next) => {
    ctx.cookies.set('jimao', '1234');
    ctx.body = '哈哈';
  });
  router.get('/2', (ctx, next) => {
    ctx.body = ctx.cookies.get('jimao') || '空';
  });
  router.get('/big/:id', async (ctx, next) => {
    await timers.setTimeout(4000);
    ctx.body = {
      id: ctx.params.id,
      data: ctx,
      ppt,
    };
  });
  router.get('/fast/:id', async (ctx, next) => {
    ctx.body = {
      id: ctx.params.id,
      data: ctx,
      ppt,
    };
  });
  router.get('/slow/:id', async (ctx, next) => {
    console.log('已经收到执行机发出的请求');
    await timers.setTimeout(20000);
    ctx.body = {
      id: ctx.params.id,
      data: ctx,
      ppt,
    };
  });
  router.get('/bignum', (ctx) => {
    ctx.set('Content-Type', 'application/json');
    ctx.body = `{"num": 123456789012345678901234567890}`;
  });
  router.get('/smallnum', (ctx) => {
    ctx.set('Content-Type', 'application/json');
    ctx.body = `{"num": 1234567890}`;
  });
  router.post('/file', async (ctx) => {
    const filePath = 'report.xlsx'; // 设置文件路径
    await send(ctx, filePath); // 发送文件
  });
  router.post('/file', async (ctx) => {
    const filePath = 'report.xlsx'; // 设置文件路径
    await send(ctx, filePath); // 发送文件
  });
  router.post('/api/xsky/trace/tree', async (ctx) => {
    const jsonText = fs.readFileSync('src/tree2.txt', 'utf8');
    ctx.body = JSON.parse(jsonText);
  });
  router.post('/api/paas/users/loginAdmin', async (ctx) => {
    console.log('/api/paas/users/loginAdmin');
    const options: any = {
      expires: dayjs('2024-09-08').toDate(),
      // httpOnly: false,
      // sameSite: 'none',
      // secure: true,
    };
    ctx.cookies.set('sys_token', '42b47b905c664f50a70e6b1d4d637ed9', options);
    ctx.cookies.set('sys_env_id', '822313712173449216', options);
    ctx.cookies.set('sys_env_code', 'Init', options);
    ctx.cookies.set('sys_jm', 'haha', options);
    ctx.body = {
      "code": "000000",
      "result": "SUCCESS",
      "message": null,
      "msgExt": null,
      "sourceCode": null,
      "extParams": null,
      "object": "42b47b905c664f50a70e6b1d4d637ed9",
      "success": true,
      "error": false
    };
  });
  router.post('/api/paas/commons/cookies', (ctx) => {
    ctx.body = { };
  });
  router.post('/api/list', (ctx) => {
    ctx.body = [
      { name: '你好' },
      { name: '世界' },
      { name: '大声' },
    ];
  });
  app
    .use(router.routes())
    .use(router.allowedMethods());
  app.listen(4000);
}

dev();

// axios.post(`https://retail-test.belle.cn/frs//sku_coding_repeated/do_frs_export?menuTitle=INT-网销日常核对自检`).then((data) => {
//   console.log(data);
// });